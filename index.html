<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Perfis - Eproc</title>
    <!-- Incluindo Tailwind CSS para estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .table-header {
            background-color: #fef3c7; /* yellow-100 */
        }
    </style>
</head>
<body class="antialiased text-slate-800 flex flex-col min-h-screen">

    <div class="container mx-auto p-4 flex-grow">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Ferramenta de Consulta - Perfis de Delegacias no Eproc</h1>
            <p class="mt-2 text-lg text-slate-600">Use os filtros abaixo para explorar as permissões e funções.</p>
        </header>

        <main class="max-w-5xl mx-auto">
            
            <!-- Card de Filtros com Novo Layout -->
            <div class="card p-6 mb-8 bg-slate-200 border-2 border-slate-400 shadow-lg">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="profile-filter" class="flex items-center text-lg font-semibold mb-3 text-slate-800">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                            1. Ver por Perfil:
                        </label>
                        <select id="profile-filter" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                            <option value="">-- Selecione um perfil --</option>
                        </select>
                    </div>
                    <div>
                        <label for="action-filter" class="flex items-center text-lg font-semibold mb-3 text-slate-800">
                             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                            2. Funcionalidade do Menu lateral:
                        </label>
                        <select id="action-filter" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                            <option value="">-- Selecione uma funcionalidade --</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6 border-t border-slate-300 pt-6 text-center">
                     <button id="clear-filters-btn" class="bg-gradient-to-r from-slate-600 to-slate-800 text-white font-semibold px-6 py-2 rounded-lg hover:from-slate-700 hover:to-slate-900 transition-all shadow-md transform hover:scale-105 flex items-center justify-center mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        Limpar Filtros
                    </button>
                </div>
            </div>
            <div id="summary-card" class="card p-6 mb-8 hidden bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 shadow-xl">
                <h3 id="summary-title" class="text-2xl font-bold text-blue-800 mb-3"></h3>
                <p id="summary-description" class="text-base text-slate-700 leading-relaxed"></p>
            </div>
            <div id="results-card" class="card overflow-hidden bg-amber-50 shadow-xl mb-8 border border-amber-200">
                <div id="results-header" class="p-6 border-b border-amber-200 hidden">
                     <h2 id="results-title" class="text-2xl font-bold text-amber-800">Resultados</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left text-sm sm:text-base">
                        <thead id="table-head" class="table-header"></thead>
                        <tbody id="results-table">
                            <tr id="empty-state">
                                <td colspan="2" class="text-center p-10">
                                    <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                                    <h3 class="mt-2 text-sm font-medium text-slate-900">Aguardando sua seleção</h3>
                                    <p class="mt-1 text-sm text-slate-500">Escolha um perfil ou uma funcionalidade para começar.</p>
                                </td>
                            </tr>
                            <tr id="no-results-state" class="hidden">
                                <td colspan="2" class="text-center p-10">
                                    <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    <h3 class="mt-2 text-sm font-medium text-slate-900">Nenhum resultado encontrado</h3>
                                    <p class="mt-1 text-sm text-slate-500">Tente ajustar seus filtros.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Rodapé -->
    <footer class="bg-slate-800 mt-12 py-6">
        <div class="container mx-auto text-center text-slate-300">
            <div class="flex flex-col items-center justify-center">
                <p class="text-sm">Criado pela equipe SGS 2.3.2</p>
            </div>
        </div>
    </footer>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- LÓGICA DO VISUALIZADOR DE PERFIS ---
            const profileFilter = document.getElementById('profile-filter');
            const actionFilter = document.getElementById('action-filter');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            const summaryCard = document.getElementById('summary-card');
            const summaryTitle = document.getElementById('summary-title');
            const summaryDesc = document.getElementById('summary-description');
            const resultsCard = document.getElementById('results-card');
            const resultsHeader = document.getElementById('results-header');
            const resultsTitle = document.getElementById('results-title');
            const tableHead = document.getElementById('table-head');
            const resultsTable = document.getElementById('results-table');
            const emptyStateRow = document.getElementById('empty-state');
            const noResultsRow = document.getElementById('no-results-state');

            const csvData = `Funcionalidades Menu lateral;Delegado/Oficial - Chefe;Escrivão/ Encarregado - Chefe;Delegado/Oficial;Escrivão/Encarregado
Cadastro de Usuários;Sim;Sim;Não;Não
Distribuir inquérito (iniciar o peticionamento);Não;Não;Sim;Sim
Peticionamento intermediário em processos;Sim;Sim;Sim;Sim
Gerenciamento da Unidade;Sim;Sim;Não;Não
Gerenciamento de processos;Sim - pode associar, substituir ou excluir o usuário da polícia vinculado ao processo.;Sim - pode associar/ substituir/desativar o usuário da polícia vinculado ao processo.;Sim - pode associar/ substituir/desativar  apenas nos processos em que está vinculado;Sim - pode associar/ substituir/desativar  apenas nos processos em que está vinculado
Consulta Processual;Sim;Sim;Sim;Sim
Cadastro de operações da Polícia;Sim;Sim;Sim;Sim
Redistribuição de inquérito;Sim;Sim;Não;Não
Cadastro de permissão/negação expressa;Sim - através do botão "Permissão/Negação Expressa" pela capa do processo e pelo menu lateral "Permissões Expressas".;Sim - através do botão "Permissão/Negação Expressa" pela capa do processo.;Sim - através do botão "Permissão/Negação Expressa" pela capa do processo.;Sim - através do botão "Permissão/Negação Expressa" pela capa do processo.
Relatórios;Sim - todos os processos da entidade;Sim - todos os processos da entidade;Parcial - somente processos nos quais atua;Parcial - somente processos nos quais atua`;
            
            const profileDescriptions = {
              'Delegado/Oficial - Chefe': 'Recebe as citações e é o principal responsável pela Entidade (Unidade Policial) e por todos os seus integrantes. Pode gerenciar todos os processos, usuários e possui a visão mais ampla do sistema.',
              'Escrivão/ Encarregado - Chefe': 'Atua como o principal administrador da unidade. É responsável por cadastrar novos usuários, gerenciar o quadro de servidores na plataforma e organizar o acervo de processos da entidade.',
              'Delegado/Oficial': 'Atua diretamente nos processos judiciais aos quais está formalmente associado, realizando petições e outras movimentações processuais necessárias para o andamento dos inquéritos e procedimentos.',
              'Escrivão/Encarregado': 'Presta auxílio direto à autoridade policial (Delegado/Oficial) nos processos em que está vinculado, executando tarefas de suporte e movimentação processual sob sua alçada.'
            };
            const actionDescriptions = {
                'Cadastro de Usuários': 'Acesso da funcionalidade pelo menu lateral -> usuários: Permite criar novos logins e senhas para outros membros da equipe, definindo seus perfis e permissões de acesso ao sistema eproc. Também é possível reinicializar senha de usuários cadastrados.',
                'Distribuir inquérito (iniciar o peticionamento)': 'Acesso da funcionalidade pelo menu lateral -> Inquérito : Capacidade de interpor diretamente um inquérito policial eletrônico submetendo documentos, manifestações e requerimentos.',
                'Peticionamento intermediário em processos': 'Acesso da funcionalidade pelo menu lateral -> Petição/Movimentação : Refere-se à habilidade de protocolar petições e outros documentos em processos judiciais gerais que tramitam no eproc, não se limitando a inquéritos.',
                'Gerenciamento da Unidade': 'Acesso da funcionalidade pelo menu lateral -> Gerenciamento da Unidade: Funções administrativas sobre a unidade policial no sistema, como a gestão do quadro de usuários (associar/desassociar) e a definição de chefias.',
                'Gerenciamento de processos': 'Acesso da funcionalidade pelo menu lateral : Controle sobre o fluxo dos processos, incluindo a associação de responsáveis, substituição de usuários em um ou mais casos e a desativação de acesso a processos específicos.',
                'Consulta Processual': 'Acesso da funcionalidade pelo menu lateral: Acesso à base de dados de processos para busca e visualização de informações, andamentos e documentos, respeitando os níveis de sigilo.',
                'Cadastro de operações da Polícia': 'Acesso da funcionalidade pelo menu lateral -> Operações da Polícia: Permissão para registrar no sistema novas operações policiais, vinculando-as a procedimentos ou inquéritos existentes.',
                'Redistribuição de inquérito': 'Acesso da funcionalidade pelo menu lateral -> Ato de transferir um inquérito policial para outra localidade, podendo alterar o rito, classe, assunto, competência.',
                'Cadastro de permissão/negação expressa': 'Acesso da funcionalidade pelo menu lateral -> Permissões Expressas -> Funcionalidade para conceder ou revogar, de forma individualizada, o acesso de um usuário a um processo ou documento específico, sobrepondo-se às regras gerais de permissão.',
                'Relatórios': 'Acesso da funcionalidade pelo menu lateral : Habilidade de extrair dados do sistema em formato de relatório, como listas de processos por período, por usuário, ou relatórios de produtividade e movimentação.'
            };

            const lines = csvData.trim().split('\n');
            const headers = lines[0].split(';');
            const profiles = headers.slice(1);
            const actionsData = [];
            const actionNames = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(';');
                const actionName = values[0];
                actionNames.push(actionName);
                const action = { name: actionName };
                for (let j = 1; j < headers.length; j++) {
                    action[headers[j]] = values[j] || 'Não informado';
                }
                actionsData.push(action);
            }

            profiles.forEach(profile => {
                const option = document.createElement('option');
                option.value = profile;
                option.textContent = profile;
                profileFilter.appendChild(option);
            });
            
            actionNames.sort((a, b) => a.localeCompare(b));
            actionNames.forEach(actionName => {
                const option = document.createElement('option');
                option.value = actionName;
                option.textContent = actionName;
                actionFilter.appendChild(option);
            });

            function updateVisualizerView() {
                const selectedProfile = profileFilter.value;
                const selectedAction = actionFilter.value;

                summaryCard.classList.add('hidden');
                resultsHeader.classList.add('hidden');
                emptyStateRow.style.display = 'none';
                noResultsRow.classList.add('hidden');
                tableHead.innerHTML = '';
                resultsTable.innerHTML = '';

                if (!selectedProfile && !selectedAction) {
                    resultsTable.appendChild(emptyStateRow);
                    emptyStateRow.style.display = 'table-row';
                    return;
                }
                
                let rowsGenerated = 0;
                resultsHeader.classList.remove('hidden');

                if (selectedProfile) {
                    const description = profileDescriptions[selectedProfile];
                    if (description) {
                        summaryTitle.textContent = selectedProfile;
                        summaryDesc.textContent = description;
                        summaryCard.classList.remove('hidden');
                    }
                    resultsTitle.textContent = `Permissões Detalhadas para: ${selectedProfile}`;
                    tableHead.innerHTML = `<tr><th scope="col" class="px-6 py-4 font-semibold text-slate-900">Funcionalidade</th><th scope="col" class="px-6 py-4 font-semibold text-slate-900">Permissão</th></tr>`;
                    actionsData.forEach(action => {
                        const row = createRow(action.name, action[selectedProfile]);
                        resultsTable.appendChild(row);
                        rowsGenerated++;
                    });
                } else if (selectedAction) {
                    const description = actionDescriptions[selectedAction];
                     if (description) {
                        summaryTitle.textContent = selectedAction;
                        summaryDesc.textContent = description;
                        summaryCard.classList.remove('hidden');
                    }
                    resultsTitle.textContent = `Perfis com permissão para: ${selectedAction}`;
                    tableHead.innerHTML = `<tr><th scope="col" class="px-6 py-4 font-semibold text-slate-900">Perfil</th><th scope="col" class="px-6 py-4 font-semibold text-slate-900">Permissão</th></tr>`;
                    
                    const actionDetails = actionsData.find(a => a.name === selectedAction);
                    if (actionDetails) {
                        profiles.forEach(profile => {
                            const permission = actionDetails[profile];
                            const row = createRow(profile, permission);
                            resultsTable.appendChild(row);
                            rowsGenerated++;
                        });
                    }
                }

                if (rowsGenerated === 0) {
                    resultsTable.appendChild(noResultsRow);
                    noResultsRow.classList.remove('hidden');
                }
            }
            
            function createRow(cell1Text, cell2Text) {
                const row = document.createElement('tr');
                row.classList.add('border-b', 'border-slate-200', 'hover:bg-slate-50');
                const cell1 = document.createElement('td');
                cell1.textContent = cell1Text;
                cell1.classList.add('px-6', 'py-4', 'font-medium', 'text-slate-900');
                const cell2 = document.createElement('td');
                cell2.classList.add('px-6', 'py-4');
                cell2.innerHTML = formatPermission(cell2Text);
                row.appendChild(cell1);
                row.appendChild(cell2);
                return row;
            }

            function formatPermission(permission) {
                const pLower = permission ? permission.toLowerCase() : '';
                if (pLower.startsWith('sim')) return `<span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">${permission}</span>`;
                if (pLower === 'não') return `<span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">${permission}</span>`;
                if (permission === '?') return `<span class="inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 ring-1 ring-inset ring-yellow-600/20">A definir</span>`;
                return `<span class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10">${permission}</span>`;
            }

            profileFilter.addEventListener('change', () => {
                if (profileFilter.value) actionFilter.value = '';
                updateVisualizerView();
            });
            actionFilter.addEventListener('change', () => {
                if (actionFilter.value) profileFilter.value = '';
                updateVisualizerView();
            });
            clearFiltersBtn.addEventListener('click', () => {
                profileFilter.value = '';
                actionFilter.value = '';
                updateVisualizerView();
            });
            updateVisualizerView();

        });
    </script>
</body>
</html>
